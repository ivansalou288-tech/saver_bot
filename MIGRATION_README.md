# Инструкция по миграции базы данных

## Изменения в структуре БД

Теперь бот хранит последние 3 баланса для каждого пользователя в таблице `balance_history`.

### Новая структура таблицы:
- `id` - уникальный идентификатор записи
- `user` - ID пользователя
- `balance` - баланс
- `games` - количество игр
- `streak` - стрик
- `points` - баллы
- `message_id` - ID сообщения с балансом
- `created_at` - время создания записи

## Как запустить миграцию

1. Запустите скрипт миграции:
```bash
python migrate_db.py
```

Этот скрипт:
- Создаст новую таблицу `balance_history`
- Перенесет данные из старой таблицы `balanses` (если она существует)
- Создаст индекс для быстрого поиска

## Новые команды

### `.бал`
Отображает последний (активный) баланс пользователя

### `.удалить`
Удаляет последний баланс и откатывается к предыдущему. 
Нельзя удалить последнюю запись - должна остаться хотя бы одна.

## Как работает система

1. При добавлении нового баланса создается новая запись в `balance_history`
2. Автоматически удаляются старые записи, оставляя только последние 3
3. Команда `.бал` показывает последний баланс
4. Команда `.удалить` удаляет последний баланс и возвращает предыдущий

## Пример использования

```
Баланс 1000₽
Катки 10
Стрик 5
```

После добавления нового баланса:
```
Баланс 1500₽
Катки 15
Стрик 7
```

При команде `.удалить` вернется к предыдущему балансу (1000₽, 10 игр, стрик 5)
